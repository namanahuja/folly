load("@fbcode_macros//build_defs:cpp_benchmark.bzl", "cpp_benchmark")
load("@fbcode_macros//build_defs:cpp_unittest.bzl", "cpp_unittest")

oncall("fbcode_entropy_wardens_folly")

cpp_unittest(
    name = "async_trace_test",
    srcs = ["AsyncTraceTest.cpp"],
    deps = [
        "folly//folly/detail:async_trace",
        "folly//folly/portability:gtest",
    ],
)

cpp_unittest(
    name = "static_singleton_manager_test",
    srcs = ["StaticSingletonManagerTest.cpp"],
    supports_static_listing = False,
    deps = [
        "folly//folly/detail:static_singleton_manager",
        "folly//folly/lang:keep",
        "folly//folly/portability:gtest",
    ],
)

cpp_unittest(
    name = "unique_instance_test",
    srcs = ["UniqueInstanceTest.cpp"],
    deps = [
        "folly//folly:string",
        "folly//folly:traits",
        "folly//folly/detail:unique_instance",
        "folly//folly/portability:gtest",
    ],
)

cpp_unittest(
    name = "file_util_detail_test",
    srcs = [
        "FileUtilDetailTest.cpp",
    ],
    deps = [
        "folly//folly/detail:file_util_detail",
        "folly//folly/portability:gtest",
    ],
)

cpp_unittest(
    name = "perf_scoped_test",
    srcs = [
        "PerfScopedTest.cpp",
    ],
    deps = [
        "folly//folly/detail:perf_scoped",
        "folly//folly/portability:gmock",
        "folly//folly/portability:gtest",
        "folly//folly/portability:unistd",
    ],
)

cpp_unittest(
    name = "simd_any_of_test",
    srcs = [
        "SimdAnyOfTest.cpp",
    ],
    deps = [
        "folly//folly:range",
        "folly//folly/detail:simd_any_of",
        "folly//folly/detail:simd_char_platform",
        "folly//folly/portability:gtest",
    ],
)

cpp_unittest(
    name = "simd_for_each_test",
    srcs = [
        "SimdForEachTest.cpp",
    ],
    deps = [
        "folly//folly/detail:simd_for_each",
        "folly//folly/portability:gtest",
    ],
)

cpp_unittest(
    name = "simple_simd_string_utils_test",
    srcs = [
        "SimpleSimdStringUtilsTest.cpp",
    ],
    deps = [
        "folly//folly/detail:simd_char_platform",
        "folly//folly/detail:simple_simd_string_utils",
        "folly//folly/portability:gtest",
    ],
)

cpp_unittest(
    name = "split_string_simd_test",
    srcs = [
        "SplitStringSimdTest.cpp",
    ],
    deps = [
        "folly//folly:fbstring",
        "folly//folly:fbvector",
        "folly//folly:range",
        "folly//folly:small_vector",
        "folly//folly/detail:split_string_simd",
        "folly//folly/portability:gtest",
    ],
)

cpp_unittest(
    name = "unroll_utils_test",
    srcs = [
        "UnrollUtilsTest.cpp",
    ],
    deps = [
        "folly//folly/detail:unroll_utils",
        "folly//folly/portability:gtest",
    ],
)

cpp_unittest(
    name = "thread_local_detail_test",
    srcs = [
        "ThreadLocalDetailTest.cpp",
    ],
    deps = [
        "folly//folly:synchronized",
        "folly//folly:thread_local",
        "folly//folly/portability:gtest",
        "folly//folly/synchronization/test:barrier",
    ],
)

cpp_benchmark(
    name = "thread_local_benchmark",
    srcs = ["ThreadLocalBenchmark.cpp"],
    deps = [
        "folly//folly:benchmark",
        "folly//folly:thread_local",
        "folly//folly/synchronization/test:barrier",
    ],
)

cpp_unittest(
    name = "traponavx512_test_negative",
    srcs = ["TrapOnAvx512TestNegative.cpp"],
    deps = [
        "folly//folly/detail:traponavx512",
        "folly//folly/portability:gtest",
    ],
)
