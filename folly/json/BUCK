load("@fbcode_macros//build_defs:cpp_library.bzl", "cpp_library")

oncall("fbcode_entropy_wardens_folly")

cpp_library(
    name = "dynamic",
    srcs = [
        "dynamic.cpp",
        "json.cpp",
    ],
    headers = [
        "DynamicConverter.h",
        "dynamic.h",
        "dynamic-inl.h",
        "json.h",
    ],
    deps = [
        "folly//folly:unicode",
        "folly//folly/container:enumerate",
        "folly//folly/hash:hash",
        "folly//folly/lang:assume",
        "folly//folly/lang:bits",
        "folly//folly/portability:constexpr",
    ],
    exported_deps = [
        "folly//folly:c_portability",
        "folly//folly:conv",
        "folly//folly:expected",
        "folly//folly:format",
        "folly//folly:function",
        "folly//folly:json_pointer",
        "folly//folly:likely",
        "folly//folly:optional",
        "folly//folly:portability",
        "folly//folly:range",
        "folly//folly:traits",
        "folly//folly:utility",
        "folly//folly/container:f14_hash",
        "folly//folly/detail:iterators",
        "folly//folly/lang:exception",
    ],
    external_deps = [
        "glog",
        ("boost", None, "boost_algorithm"),
    ],
    exported_external_deps = [
        "boost",
    ],
)

cpp_library(
    name = "json_pointer",
    srcs = ["json_pointer.cpp"],
    headers = ["json_pointer.h"],
    deps = [
        "folly//folly:string",
    ],
    exported_deps = [
        "folly//folly:expected",
        "folly//folly:range",
    ],
)

cpp_library(
    name = "json_patch",
    srcs = ["json_patch.cpp"],
    headers = ["json_patch.h"],
    deps = [
        "folly//folly/container:enumerate",
    ],
    exported_deps = [
        "folly//folly:expected",
        "folly//folly:json_pointer",
        "folly//folly:optional",
        "folly//folly/json:dynamic",
    ],
    external_deps = [
        "glog",
    ],
)

cpp_library(
    name = "json_schema",
    srcs = ["JSONSchema.cpp"],
    headers = ["JSONSchema.h"],
    deps = [
        "folly//folly:c_portability",
        "folly//folly:conv",
        "folly//folly:memory",
        "folly//folly:optional",
        "folly//folly:singleton",
        "folly//folly:string",
        "folly//folly/portability:math",
    ],
    exported_deps = [
        "folly//folly:exception_wrapper",
        "folly//folly:range",
        "folly//folly/json:dynamic",
    ],
    external_deps = [
        ("boost", None, "boost_algorithm"),
        ("boost", None, "boost_regex"),
    ],
)

cpp_library(
    name = "dynamic_parser",
    srcs = ["DynamicParser.cpp"],
    headers = [
        "DynamicParser.h",
        "DynamicParser-inl.h",
    ],
    deps = [
        "folly//folly:optional",
    ],
    exported_deps = [
        "folly//folly:c_portability",
        "folly//folly:conv",
        "folly//folly/json:dynamic",
        # for toPseudoJson(), since print_as_pseudo_json() is in json.cpp
        "folly//folly:json",  # @manual
        "folly//folly:scope_guard",
        "folly//folly:traits",
    ],
    external_deps = [
        "glog",
    ],
    exported_external_deps = [
        "boost",
    ],
)

cpp_library(
    name = "json_mock_util",
    headers = ["JsonMockUtil.h"],
    exported_deps = [
        "folly//folly/portability:gmock",
        "folly//folly/test:json_test_util",
    ],
)

cpp_library(
    name = "json_test_util",
    srcs = ["JsonTestUtil.cpp"],
    headers = ["JsonTestUtil.h"],
    deps = [
        "folly//folly:conv",
        "folly//folly/lang:assume",
    ],
    exported_deps = [
        "folly//folly:range",
        "folly//folly/json:dynamic",
    ],
)
