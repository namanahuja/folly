load("@fbcode_macros//build_defs:cpp_benchmark.bzl", "cpp_benchmark")
load("@fbcode_macros//build_defs:cpp_library.bzl", "cpp_library")
load("@fbcode_macros//build_defs:cpp_unittest.bzl", "cpp_unittest")

oncall("fbcode_entropy_wardens_folly")

cpp_benchmark(
    name = "base_benchmark",
    srcs = ["BaseBenchmark.cpp"],
    headers = [],
    deps = [
        "folly//folly:benchmark",
        "folly//folly/gen:base",
    ],
    external_deps = [
        "glog",
    ],
)

cpp_unittest(
    name = "base_test",
    srcs = ["BaseTest.cpp"],
    headers = [],
    tags = [
        "serialize_test_cases",
    ],
    deps = [
        "folly//folly:fbvector",
        "folly//folly:map_util",
        "folly//folly:memory",
        "folly//folly:string",
        "folly//folly/experimental:test_util",
        "folly//folly/gen:base",
        "folly//folly/json:dynamic",
        "folly//folly/portability:gflags",
        "folly//folly/portability:gtest",
    ],
    external_deps = [
        "glog",
    ],
)

cpp_unittest(
    name = "combine_test",
    srcs = ["CombineTest.cpp"],
    headers = [],
    deps = [
        "folly//folly:fbvector",
        "folly//folly:range",
        "folly//folly/gen:base",
        "folly//folly/gen:combine",
        "folly//folly/portability:gflags",
        "folly//folly/portability:gtest",
    ],
    external_deps = [
        "glog",
    ],
)

cpp_benchmark(
    name = "file_benchmark",
    srcs = ["FileBenchmark.cpp"],
    headers = [],
    deps = [
        "folly//folly:benchmark",
        "folly//folly:file",
        "folly//folly/gen:base",
        "folly//folly/gen:file",
    ],
    external_deps = [
        "glog",
    ],
)

cpp_unittest(
    name = "file_test",
    srcs = ["FileTest.cpp"],
    headers = [],
    supports_static_listing = False,
    deps = [
        "folly//folly:file",
        "folly//folly:range",
        "folly//folly/container:array",
        "folly//folly/experimental:test_util",
        "folly//folly/gen:base",
        "folly//folly/gen:file",
        "folly//folly/portability:gtest",
    ],
)

cpp_benchmark(
    name = "parallel_benchmark",
    srcs = ["ParallelBenchmark.cpp"],
    headers = [],
    deps = [
        ":util",
        "folly//folly/gen:base",
        "folly//folly/gen:parallel",
    ],
    external_deps = [
        "glog",
    ],
)

cpp_unittest(
    name = "parallel_test",
    srcs = ["ParallelTest.cpp"],
    headers = [],
    tags = [
        "serialize",
    ],
    deps = [
        "folly//folly/gen:base",
        "folly//folly/gen:parallel",
        "folly//folly/portability:gflags",
        "folly//folly/portability:gtest",
    ],
    external_deps = [
        "glog",
    ],
)

cpp_benchmark(
    name = "parallel_map_benchmark",
    srcs = ["ParallelMapBenchmark.cpp"],
    headers = [],
    deps = [
        "folly//folly:benchmark",
        "folly//folly/gen:base",
        "folly//folly/gen:parallel_map",
        "folly//folly/portability:unistd",
    ],
)

cpp_unittest(
    name = "parallel_map_test",
    srcs = ["ParallelMapTest.cpp"],
    headers = [],
    deps = [
        "folly//folly:memory",
        "folly//folly/gen:base",
        "folly//folly/gen:parallel_map",
        "folly//folly/portability:gflags",
        "folly//folly/portability:gtest",
    ],
    external_deps = [
        "glog",
    ],
)

cpp_benchmark(
    name = "string_benchmark",
    srcs = ["StringBenchmark.cpp"],
    headers = [],
    deps = [
        "folly//folly:benchmark",
        "folly//folly:string",
        "folly//folly/container:foreach",
        "folly//folly/gen:base",
        "folly//folly/gen:string",
    ],
    external_deps = [
        "glog",
    ],
)

cpp_unittest(
    name = "string_test",
    srcs = ["StringTest.cpp"],
    headers = [],
    deps = [
        "folly//folly/functional:apply_tuple",
        "folly//folly/gen:string",
        "folly//folly/portability:gtest",
    ],
)

cpp_unittest(
    name = "istream_test",
    srcs = ["IStreamTest.cpp"],
    headers = [],
    deps = [
        "folly//folly/gen:base",
        "folly//folly/gen:istream",
        "folly//folly/gen:string",
        "folly//folly/portability:gtest",
    ],
)

cpp_library(
    name = "util",
    headers = ["Bench.h"],
    exported_deps = [
        "folly//folly:benchmark",
    ],
)
