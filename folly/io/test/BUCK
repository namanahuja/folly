load("@fbcode_macros//build_defs:cpp_binary.bzl", "cpp_binary")
load("@fbcode_macros//build_defs:cpp_unittest.bzl", "cpp_unittest")

oncall("fbcode_entropy_wardens_folly")

cpp_binary(
    name = "iobuf_benchmark",
    srcs = ["IOBufBenchmark.cpp"],
    headers = [],
    deps = [
        "folly//folly:benchmark",
        "folly//folly/io:iobuf",
    ],
)

cpp_unittest(
    name = "iobuf_test",
    srcs = ["IOBufTest.cpp"],
    headers = [],
    allocator = "jemalloc_debug",
    emails = ["simpkins@fb.com"],
    supports_static_listing = False,
    deps = [
        "folly//folly:range",
        "folly//folly/io:iobuf",
        "folly//folly/io:typed_io_buf",
        "folly//folly/memory:malloc",
        "folly//folly/portability:gtest",
    ],
)

cpp_unittest(
    name = "iobuf_cb_test",
    srcs = ["IOBufCBTest.cpp"],
    headers = [],
    allocator = "jemalloc_debug",
    emails = ["dmm@fb.com"],
    deps = [
        "folly//folly/io:iobuf",
        "folly//folly/portability:gtest",
    ],
)

cpp_binary(
    name = "iobuf_cursor_benchmark",
    srcs = ["IOBufCursorBenchmark.cpp"],
    headers = [],
    deps = [
        "folly//folly:benchmark",
        "folly//folly:format",
        "folly//folly:range",
        "folly//folly/io:iobuf",
    ],
)

cpp_unittest(
    name = "iobuf_cursor_test",
    srcs = ["IOBufCursorTest.cpp"],
    headers = [],
    deps = [
        "folly//folly:format",
        "folly//folly:range",
        "folly//folly/io:iobuf",
        "folly//folly/portability:gtest",
    ],
)

cpp_binary(
    name = "iobuf_network_bench",
    srcs = ["NetworkBenchmark.cpp"],
    headers = [],
    allocator = "jemalloc",
    deps = [
        "folly//folly:benchmark",
        "folly//folly/io:iobuf",
        "folly//folly/portability:gflags",
    ],
)

cpp_unittest(
    name = "iobuf_queue_test",
    srcs = ["IOBufQueueTest.cpp"],
    headers = [],
    deps = [
        "fbsource//third-party/fmt:fmt",
        "folly//folly:range",
        "folly//folly/io:iobuf",
        "folly//folly/portability:gtest",
    ],
)

cpp_unittest(
    name = "iobuf_iovec_builder_test",
    srcs = ["IOBufIovecBuilderTest.cpp"],
    headers = [],
    deps = [
        "folly//folly/io:iobuf",
        "folly//folly/portability:gtest",
    ],
)

cpp_binary(
    name = "queueappender_benchmark",
    srcs = ["QueueAppenderBenchmark.cpp"],
    headers = [],
    deps = [
        "folly//folly:benchmark",
        "folly//folly:format",
        "folly//folly:range",
        "folly//folly/io:iobuf",
    ],
)

cpp_unittest(
    name = "record_io_test",
    srcs = ["RecordIOTest.cpp"],
    headers = [],
    deps = [
        "folly//folly:conv",
        "folly//folly:fbstring",
        "folly//folly:random",
        "folly//folly/experimental:test_util",
        "folly//folly/io:iobuf",
        "folly//folly/io:record_io",
        "folly//folly/portability:gflags",
        "folly//folly/portability:gtest",
        "folly//folly/portability:unistd",
    ],
    external_deps = [
        "glog",
    ],
)

cpp_unittest(
    name = "shutdown_socket_set_test",
    srcs = ["ShutdownSocketSetTest.cpp"],
    headers = [],
    deps = [
        "folly//folly/io:shutdown_socket_set",
        "folly//folly/net:net_ops",
        "folly//folly/net:network_socket",
        "folly//folly/portability:gtest",
        "folly//folly/synchronization:baton",
    ],
    external_deps = [
        "glog",
    ],
)

cpp_unittest(
    name = "socket_option_value_test",
    srcs = ["SocketOptionValueTest.cpp"],
    headers = [],
    deps = [
        "folly//folly:conv",
        "folly//folly/io:socket_option_map",
        "folly//folly/portability:gtest",
    ],
    external_deps = [
        "glog",
    ],
)
